# CA (認証局) の構築と証明書の発行
openssl が入っていないなら入れる。
CA.pl というスクリプトがインストールされているのでそれを使う。
(トラブルが起きやすく、中身は大したことをしていないので、
実際のところは中身を読んで openssl コマンドを手で打つのがおすすめなのかもしれない。)
`man ca.pl` に公式ドキュメントが存在する。

```
/usr/lib/ssl/misc/CA.pl
/usr/lib/ssl/openssl.cnf
```

## CA の構築
CA の生成は少しだけ複雑なので頼ってもいいかもしれない。
パスフレーズなしにするには以下のようにする。
```
./CA.pl -newca -extra-req "-nodes"
```

何も入れずに Enter するとデフォルト値になる。
空文字列にしたい場合は "." と入力する。

* private/cakey.pem
  * CA の秘密鍵。もちろん流出しないよう気をつける。
* cacert.pem
  * CA の自己署名証明書。root CA ならこれを使う。
* careq.pem
  * CSR。他の CA に署名してもらうためにはこれを渡す。
  これに自分で署名したものが cacert.pem。

## キーペアの生成と CSR の作成
```
./CA.pl -newreq-nodes
```
こちらもプロンプトに従っていろいろ入力する。
何も入れずに Enter するとデフォルト値になる。
空文字列にしたい場合は "." と入力する。

* newkey.pem
  * 秘密鍵。お相手に渡す。
* newreq.pem
  * 対応する公開鍵に対する CSR。これに CA で署名する。

## 署名
```
./CA.pl -sign
```
再度証明書の内容が表示されるので OK ならば CA の秘密鍵で署名する。

## 形式変換
```
./CA.pl -pkcs12
```
ブラウザ等で簡単にインポートできる形式に変換する。
これをお相手に渡す。

# 推奨暗号および鍵長の目安
デジタル庁, 総務省, 経済産業省
https://www.cryptrec.go.jp/list.html
