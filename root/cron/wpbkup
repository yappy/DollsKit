#!/bin/sh -eu

# Automatic backup script
#
# Link from:
# /etc/cron.weekly/

SCRIPT_DIR=$(dirname "$(realpath "$0")")
ROOT=${SCRIPT_DIR}/../backup
BKUP_ROOT=/mnt/localbkup
LOG=/root/wpbkup.log
DB=wordpress

{
    echo --------------------------------------------------------------------------------
    date -R
    echo --------------------------------------------------------------------------------
} >> "${LOG}"

# web files
python3 "${ROOT}/bkup_local.py" \
--tag wp \
--mount-check "${BKUP_ROOT}" \
--keep-count 30 \
--db ${DB} \
/var/www/html/wp/ "${BKUP_ROOT}/wp" \
>> "${LOG}" 2>&1
